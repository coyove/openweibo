{{template "header.html" .}}

{{if .T.view}}
    {{if eq .T.page 1}}
        {{template "view.html" .}}
    {{end}}
{{else}}
<title>记事管理</title>
<div style='display:flex;align-items:center'>
    <input id=search class='tag-search-input-oneline border1' style='flex-grow:1;margin-right:1em' open-tag='true'>
    <div class='tag-box button' onclick='location.href="?q="+encodeURIComponent($("#search").val())'><a>搜索</a></div>
</div>
{{end}}

<div>
    <table id=list>
        {{if .T.query}}
        <tr class=title><td><div class=display ><span>搜索：<b>{{.T.query}}</b> ({{.T.total}})</span></div></td></tr>
        {{else}}
        <tr class=title>
            <td colspan=2>
                <div class=display >
                    <span style='flex-grow:1'>
                    {{if .T.pid}}
                        <b>{{.T.pid}}</b> 
                        <a class=tag-edit-button href='/history?user={{.T.pid}}'><span class=li_vynil></span></a>
                        创建的记事 ({{.T.total}})
                    {{else}}
                        {{if .T.view}}
                        {{if ne .T.page 1}}<b>{{.T.note.Title}} </b>{{end}}子记事
                        {{else}}
                        全部记事
                        {{end}} ({{.T.total}})
                    {{end}}
                    </span>

                    <div>
                        {{if .T.view}}
                        {{$title := .T.note.EscapedTitle}}
                        <a class='tag-edit-button li_paperplane' href='/new?pt={{.T.note.Id}},{{$title}}&title=Re:%20{{$title}}%20{{add .T.total 1}}'></a>
                        {{end}}
                        <a class='tag-edit-button icon-sort-name-up {{if and (eq .T.sort 1) (not .T.desc)}}selected{{end}}' href='?sort=1&pid={{.T.pid}}'></a>
                        <a class='tag-edit-button icon-sort-name-down {{if and (eq .T.sort 1) (.T.desc)}}selected{{end}}' href='?sort=1&desc=1&pid={{.T.pid}}'></a>
                        <a class='tag-edit-button icon-sort-number-up {{if and (eq .T.sort 0) (not .T.desc)}}selected{{end}}' href='?sort=0&pid={{.T.pid}}'></a>
                        <a class='tag-edit-button icon-sort-number-down {{if and (eq .T.sort 0) (.T.desc)}}selected{{end}}' href='?sort=0&desc=1&pid={{.T.pid}}'></a>
                    </div>
                </div>
            </td>
        </tr>
        {{end}}

        {{range .T.tags}}
        <tr id='tag{{.Id}}'>
            <td tag-id={{.Id}} class='tag-edit'>
                <script type="application/json" class=tag-data>{{.Data}}</script>
                <div class=display >
                    <a href='/t/{{.EscapedTitle}}' class=tag-edit-name>{{if .PendingReview}}{{.ReviewTitle}}{{else}}{{.Title}}{{end}}</a>
                    {{if .Lock}}<div class='tag-edit-button li_lock' disabled></div>{{end}}
                    {{if .PendingReview}}<div class='tag-edit-button li_stack' disabled title='审核中'></div>{{end}}
                    <a class='tag-edit-button li_pen' href='/edit?id={{.Id}}'></a>
                </div>
            </td>
            <td class='small'>{{formatUnixMilli .UpdateUnix}}</td>
        </tr>
        {{end}}
    </table>
    <table id=edit style='display:none'>
    </table>
</div>

<div id=page style='text-align:center'>
    {{range (generatePages .T.page .T.pages)}}
        {{if eq . 0}}
        <span>...</span>
        {{else}}
        <div class='tag-box nav-page button {{if eq . $.T.page}}selected{{end}}'>
            {{if eq . $.T.page}}
            <span><b>{{.}}</b></span>
            {{else}}
            <a href='?{{$.BuildPageLink .}}&pid={{$.T.pid}}'>{{.}}</a>
            {{end}}
        </div>
        {{end}}
    {{end}}
</div>

{{template "footer.html" .}}
