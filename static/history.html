{{template "header.html" .}}

<style>
.diff {
    display: flex;
    line-height: 2em;
}
.diff-header {
    font-size:90%; white-space:initial;line-height:1.25em;margin:0.2em 0;
    align-items:center; display:flex; flex-grow: 1;
}
.diff-header-ip {
    font-size:90%; color: #aaa;
}
</style>

<div>
    <table id=list class=table>
        <tr class=title>
            <td colspan=2>
                <div class=display >
                    <div style='flex-grow:1'>
                        {{if eq .T.viewType "note"}}
                            <title>{{.T.note.HTMLTitleDisplay}} 编辑历史</title>
                            <b class=wrapall>{{.T.note.HTMLTitleDisplay}}</b>
                            <a class=tag-edit-button href='/{{.T.note.EscapedTitle}}'><span class=icon-eye></span></a>
                            <a class=tag-edit-button href='/ns:edit?id={{.T.note.Id}}'><span class=icon-pencil></span></a>
                            修改历史
                        {{end}}

                        {{if eq .T.viewType "user"}}
                            <title>{{.T.id}} 编辑历史</title>
                            {{.T.id}}
                            <a class=tag-edit-button href='/ns:manage?sort=0&q=ns:user:{{.T.id}}'><span class=icon-search></span></a>
                            编辑历史
                        {{end}}

                        {{if eq .T.viewType "all"}}
                            <title>全站编辑历史</title>
                            <span>全站编辑历史</span>
                        {{end}}
                        <span>({{.T.total}})</span>
                    </div>
                    <div>
                        <a class='tag-edit-button icon-sort-number-up {{if not .P.Desc}}selected{{end}}' href='/ns:history?{{.T.viewType}}={{.T.id}}'></a>
                        <a class='tag-edit-button icon-sort-number-down {{if .P.Desc}}selected{{end}}' href='/ns:history?{{.T.viewType}}={{.T.id}}&desc=1'></a>
                    </div>
                </div>
            </td>
        </tr>
        {{range .T.records}}
        <tr>
            <td>
                <b>{{.ActionName}}</b>
            </td>
            <td>
                <div class=diff>
                    <div class='diff-header'>
                        {{.Modifier}}&nbsp;
                        <a href='/ns:history?user={{.Modifier}}&desc=1' class='tag-edit-button icon-user'></a>&nbsp;
                    </div>
                    <div class=diff-header-ip>{{.ModifierIP}}</div>
                </div>
            </td>
        </tr>
        <tr id='record{{.Id}}'>
            <td class='small'><div>{{formatUnixMilli .CreateUnix}}</div></td>
            {{$rid := .Id}}
            {{$ipa := .IsPlainAction}}
            {{$msg := .RejectMsg}}
            {{with .Note}}
            <td class='tag-edit'>
                <div class=display>
                    <div style='flex-grow:1'>
                        {{if $ipa}}
                        <span class=wrapall>{{.HTMLTitleDisplay}}{{if $msg}}&emsp;<i>留言：{{safeHTML $msg}}</i>{{end}}</span>
                        {{else}}
                            {{if ne .Image .ReviewImage}}<span class=icon-photo></span>{{end}}
                            <a class=wrapall href='/ns:edit?hid={{$rid}}'>{{.HTMLTitleDisplay}}</a>
                        {{end}}
                    </div>
                </div>
            </td>
            {{end}}
        </tr>
        {{end}}
    </table>
</div>

<div id=page>
    {{range (generatePages .P.Page .T.pages)}}
        {{if eq . 0}}
            <div style='width:2em;text-align:center'>&middot;&middot;&middot;</div>
        {{else}}
            {{if eq . $.P.Page}}
            <div class='tag-box nav-page button selected'><span><b>{{.}}</b></span></div>
            {{else}}
            <a class=nav-page href='?{{$.BuildPageLink .}}&{{$.T.viewType}}={{$.T.id}}'><div class='tag-box nav-page button'>{{.}}</div></a>
            {{end}}
        {{end}}
    {{end}}
</div>
{{template "footer.html" .}}
